--Q0. Examine the trends in the number of extended matura exams to basics matura exams across last 4 years 
WITH
    MEMBER [Measures].[Extended Exams Count] AS
        ([Dim Matura].[Level].&[extended], [Measures].[Fact Writing Matura Exam Count])

    MEMBER [Measures].[Basic Exams Count] AS
        ([Dim Matura].[Level].&[basic], [Measures].[Fact Writing Matura Exam Count])

    MEMBER [Measures].[Extended to Basic %] AS
        IIF(
            [Measures].[Basic Exams Count] = 0,
            NULL,
            [Measures].[Extended Exams Count] / [Measures].[Basic Exams Count]
        ),
        FORMAT_STRING = "Percent"

SELECT 
    {[Dim Date].[Year].&[2021], [Dim Date].[Year].&[2022], [Dim Date].[Year].&[2023], [Dim Date].[Year].&[2024]} ON COLUMNS,
    {
        [Measures].[Extended Exams Count],
        [Measures].[Basic Exams Count],
        [Measures].[Extended to Basic %]
    } ON ROWS
FROM [Data Warehouses]

--Q1. Examine the trends in the number of students by the chosen level of matura exams across the last 4 years.
WITH
MEMBER [Measures].[Extended Student Count] AS
    DISTINCTCOUNT(
        NONEMPTY(
            [Dim Student].[ID Student].MEMBERS,
            (
                [Measures].[Fact Writing Matura Exam Count],
                [Dim Matura].[Level].&[extended]
            )
        )
    )

MEMBER [Measures].[Basic Student Count] AS
    DISTINCTCOUNT(
        NONEMPTY(
            [Dim Student].[ID Student].MEMBERS,
            (
                [Measures].[Fact Writing Matura Exam Count],
                [Dim Matura].[Level].&[basic]
            )
        )
    )

MEMBER [Measures].[Extended to Basic %] AS
    IIF(
        [Measures].[Basic Student Count] = 0,
        NULL,
        [Measures].[Extended Student Count] / [Measures].[Basic Student Count]
    ),
    FORMAT_STRING = "Percent"

SELECT 
    {
        [Dim Date].[Year].&[2021],
        [Dim Date].[Year].&[2022],
        [Dim Date].[Year].&[2023],
        [Dim Date].[Year].&[2024]
    } ON COLUMNS,
    {
        [Measures].[Extended Student Count],
        [Measures].[Basic Student Count],
        [Measures].[Extended to Basic %]
    } ON ROWS
FROM [Data Warehouses]



--Q2. Compare the results of students retaking the matura exam last year with the previous 3 years.
WITH
MEMBER [Measures].[Average Retake Score] AS
    IIF(
        [Measures].[Number of retakes] = 0,
        NULL,
        [Measures].[Score] / [Measures].[Number of retakes]
    )
MEMBER [Measures].[Students Retaking] AS
    DISTINCTCOUNT(
        NONEMPTY(
            [Dim Student].[ID Student].MEMBERS,
            (
                [Measures].[Fact Writing Matura Exam Count],
                [Dim Junk].[Retake].&[Retake]
            )
        )
    )

SELECT 
    {
		[Dim Date].[Year].&[2021],
		[Dim Date].[Year].&[2022],
		[Dim Date].[Year].&[2023],
		[Dim Date].[Year].&[2024]
    } ON COLUMNS,

    {
		[Measures].[Students Retaking],
        [Measures].[Average Retake Score]

    } ON ROWS

FROM [Data Warehouses]
WHERE ([Dim Junk].[Retake].&[Retake])






--Q3. Compare the average results of the students who wrote exams in smaller classrooms (up to 15 people) ang big classrooms (16-40 people) in the last year.
SELECT
    {[Measures].[Average]} ON COLUMNS,
    [Dim Room].[Size].[Size].MEMBERS ON ROWS
FROM [Data Warehouses]
WHERE ([Dim Date].[Year].&[2024])



--Q4. Compare the results from the matura exam from last year to the previous 3 years.
SELECT
    {[Measures].[Average]} ON COLUMNS,
    {[Dim Date].[Year].&[2021], 
	[Dim Date].[Year].&[2022], 
	[Dim Date].[Year].&[2023], 
	[Dim Date].[Year].&[2024]} ON ROWS
FROM [Data Warehouses]



--Q5. Compare the results from extended math matura exams from students who were in a particular profiled class vs those who took the extended exam from the subject that was not extended in their class in the last 4 years. 
WITH
MEMBER [Measures].[Class with Extended Math Score] AS
    AVG(
        FILTER(
            [Dim Student].[ID Student].MEMBERS,
            (
                [Dim Student].[ID Student].CurrentMember.Properties("Class Name") = "economics"
                OR [Dim Student].[ID Student].CurrentMember.Properties("Class Name") = "science"
                OR [Dim Student].[ID Student].CurrentMember.Properties("Class Name") = "programming"
                OR [Dim Student].[ID Student].CurrentMember.Properties("Class Name") = "chemical"
                OR [Dim Student].[ID Student].CurrentMember.Properties("Class Name") = "biological"
            )
        ),
        (
            [Measures].[Average], 
            [Dim Matura].[Subject].&[Mathematics], 
            [Dim Matura].[Level].&[Extended]
        )
    )

MEMBER [Measures].[Class without Extended Math Score] AS
    AVG(
        FILTER(
            [Dim Student].[ID Student].MEMBERS,
             (
                [Dim Student].[ID Student].CurrentMember.Properties("Class Name") = "law"
                OR [Dim Student].[ID Student].CurrentMember.Properties("Class Name") = "linguistic"
                OR [Dim Student].[ID Student].CurrentMember.Properties("Class Name") = "medical"
            )
        ),
        (
            [Measures].[Average], 
            [Dim Matura].[Subject].&[Mathematics], 
            [Dim Matura].[Level].&[Extended]
        )
    )

SELECT
    {
        [Dim Date].[Year].&[2021], 
        [Dim Date].[Year].&[2022], 
        [Dim Date].[Year].&[2023], 
        [Dim Date].[Year].&[2024]
    } ON COLUMNS,
	{
        [Measures].[Class with Extended Math Score],
        [Measures].[Class without Extended Math Score]
    } ON ROWS
FROM [Data Warehouses]







--Q6. In how many small classes the matura exams were held last year compared to the previous 3 years?
--hierarhy operations
WITH
MEMBER [Measures].[Small Class Exam Count] AS
    SUM(
        FILTER(
            [Dim Room].[Size].MEMBERS,
            [Dim Room].[Size].CurrentMember.Name = "small"
        ),
        [Measures].[Number of classrooms]
    )

SELECT
    {[Measures].[Small Class Exam Count]} ON COLUMNS,
    {
        [Dim Date].[Year].&[2021],
        [Dim Date].[Year].&[2022],
        [Dim Date].[Year].&[2023],
        [Dim Date].[Year].&[2024]
    } ON ROWS
FROM [Data Warehouses]

--Q7. How many people were writing other than extended math, extended maturas last year?
WITH
SET [Not Math Extended Exams] AS
    FILTER(
        NONEMPTY(
            [Dim Matura].[Hierarchy].MEMBERS, 
            ([Measures].[Fact Writing Matura Exam Count], [Dim Date].[Year].&[2024])
        ),
        [Dim Matura].[Level].CurrentMember.Name = "extended"
        AND [Dim Matura].[Subject].CurrentMember.Name <> "Mathematics"
    )

SET [StudentsWithNonMathExtended] AS
    NONEMPTY(
        [Dim Student].[Hierarchy].MEMBERS,
        (
            [Measures].[Fact Writing Matura Exam Count],
            [Dim Date].[Year].&[2024],
            [Non Math Extended Exams]
        )
    )

MEMBER [Measures].[Studnts with other extended maturas] AS
    DISTINCTCOUNT([StudentsWithNonMathExtended])

SELECT 
    [Measures].[Studnts with other extended maturas] ON COLUMNS, 
	[Dim Date].[Year].&[2024] ON ROWS
FROM [Data Warehouses]






--Q8. Extended math students from Profiled Classes
SELECT
[Measures].[Fact Writing Matura Exam Count]ON COLUMNS,
    {
        [Dim Profile Class].[Class Name].&[medical],
        [Dim Profile Class].[Class Name].&[science],
        [Dim Profile Class].[Class Name].&[biological],
        [Dim Profile Class].[Class Name].&[chemical],
        [Dim Profile Class].[Class Name].&[programming]
    } ON ROWS
FROM [Data Warehouses]
WHERE (
    [Dim Matura].[Subject].&[Mathematics],
    [Dim Matura].[Level].&[Extended],
    [Dim Date].[Year].&[2024]
)



--Q9. Retaking Basics Math compare last year to lst 3 years

WITH 
MEMBER [Measures].[Average Retake Score] AS
    IIF(
        [Measures].[Number of retakes] = 0,
        NULL,
        [Measures].[Score] / [Measures].[Number of retakes]
    )

SELECT 
    {
        [Measures].[Number of retakes], 
        [Measures].[Average Retake Score]
    } ON COLUMNS,

    { 
		[Dim Date].[Year].&[2018], 
		[Dim Date].[Year].&[2019], 
		[Dim Date].[Year].&[2020], 
		[Dim Date].[Year].&[2021], 
		[Dim Date].[Year].&[2022], 
		[Dim Date].[Year].&[2023], 
		[Dim Date].[Year].&[2024]
		
    } ON ROWS

FROM [Data Warehouses]

WHERE ([Dim Matura].[Subject].&[Physics],
       [Dim Matura].[Level].&[extended],
	   [Dim Junk].[Retake].&[Retake])



--Q10. Absent Students in Last Year
WITH
MEMBER [Measures].[Present Students] AS
    COUNT(
        FILTER(
            [Dim Student].[ID Student].MEMBERS,
            ([Measures].[Duration]) > 0
        )
    )

MEMBER [Measures].[Total Students] AS
    COUNT(
        NONEMPTY(  
            [Dim Student].[ID Student].MEMBERS,
            ([Measures].[Duration])
        )
    )

MEMBER [Measures].[Absent Students] AS
    [Measures].[Total Students] - [Measures].[Present Students]

SELECT
    NONEMPTY(
        CROSSJOIN(
            [Dim Matura].[Subject].[Subject].MEMBERS,
            [Dim Matura].[Level].[Level].MEMBERS
        )
    ) ON COLUMNS,

    [Dim Date].[Year].&[2024] ON ROWS

FROM [Data Warehouses]

WHERE ([Measures].[Absent Students])




--Q11. Classrooms where exam was anulled (2 years ago)
WITH 
MEMBER [Measures].[Annulled Room Count] AS
    COUNT(
        NONEMPTY(
            [Dim Room].[Room Number].[Room Number].MEMBERS,
            ([Dim Junk].[Annulled].&[Anulled], [Measures].[Fact Writing Matura Exam Count])
        )
    )

SELECT
    [Measures].[Annulled Room Count] ON COLUMNS
FROM [Data Warehouses]
WHERE ([Dim Date].[Year].&[2023])


-- Q12: Top 5 students by average score in Extended Math in 2024
SELECT
    {[Measures].[Average]} ON COLUMNS,
    TOPCOUNT(
        [Dim Student].[ID Student].MEMBERS,
        5,
        ([Measures].[Average])
    ) ON ROWS
FROM [Data Warehouses]
WHERE (
    [Dim Matura].[Subject].&[Mathematics],
    [Dim Matura].[Level].&[Extended],
    [Dim Date].[Year].&[2024]
)



